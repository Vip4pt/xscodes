<!-- 已根据你的新布局要求重构页面结构和功能：
1. 三栏布局（左输入 | 右上统计 | 右下地区查看）
2. 地区按钮切换（可视化）
3. 地区显示为原始节点链接
4. 可切换显示所有节点JSON） -->
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>节点统计与地区查看工具</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
<div class="grid grid-cols-3 gap-4 h-screen">

  <!-- 左侧输入 -->
  <div class="col-span-1 flex flex-col">
    <h2 class="text-xl font-bold mb-2">粘贴节点地址</h2>
    <textarea id="input" class="flex-1 border p-2 rounded" placeholder="支持 ss / ssr / vmess / vless / trojan...每行一个"></textarea>
    <button id="parseBtn" class="mt-2 bg-blue-600 text-white p-2 rounded">开始解析</button>
  </div>

  <!-- 右侧 -->
  <div class="col-span-2 grid grid-rows-2 gap-4">

    <!-- 右上：统计 -->
    <div class="bg-white p-3 rounded shadow overflow-auto">
      <h2 class="text-xl font-bold mb-2">统计信息</h2>
      <div id="typeStats" class="mb-2"></div>
      <div id="regionStats" class="mb-2"></div>
      <div>
        <strong>名称合集：</strong>
        <div id="nameList" class="text-sm mt-1 max-h-24 overflow-auto"></div>
      </div>
      <button id="toggleJson" class="mt-3 bg-gray-700 text-white px-3 py-1 rounded">显示/隐藏 全部节点JSON</button>
      <pre id="jsonOutput" class="hidden text-xs bg-black text-green-400 p-2 mt-2 overflow-auto max-h-40"></pre>
    </div>

    <!-- 右下：地区按钮 + 节点列表 -->
    <div class="bg-white p-3 rounded shadow flex flex-col">
      <h2 class="text-xl font-bold mb-2">按地区查看节点</h2>
      <div id="regionButtons" class="mb-2 flex flex-wrap gap-2"></div>
      <textarea id="nodeOutput" class="flex-1 border p-2 rounded text-sm" placeholder="这里显示选择地区的节点地址"></textarea>
    </div>

  </div>
</div>

<script>
const regions = {
  HK:['香港','HK','hong'],
  TW:['台湾','TW'],
  JP:['日本','JP','东京'],
  SG:['新加坡','SG'],
  US:['美国','US','洛杉矶','硅谷','纽约'],
  KR:['韩国','KR','首尔'],
  OTHER:[]
}

let allNodes = [];

function safeBase64Decode(str){
  try{
    str = str.replace(/-/g,'+').replace(/_/g,'/');
    return decodeURIComponent(escape(atob(str)));
  }catch(e){return str}
}

function detectRegion(text){
  for(const r in regions){
    for(const k of regions[r]){
      if(text.toLowerCase().includes(k.toLowerCase())) return r
    }
  }
  return 'OTHER'
}

function parseNode(line){
  let type = line.split('://')[0]
  let name = ''
  let server = ''

  if(type === 'vmess'){
    const data = JSON.parse(safeBase64Decode(line.replace('vmess://','')))
    name = data.ps || ''
    server = data.add || ''
  }else{
    const arr = line.split('#')
    name = decodeURIComponent(arr[1]||'')
    server = arr[0]
  }

  const region = detectRegion(name + server)

  return { type, name, server, region, raw: line }
}

function renderRegionButtons(regionCount){
  const box=document.getElementById('regionButtons')
  box.innerHTML=''
  Object.keys(regionCount).forEach(r=>{
    const btn=document.createElement('button')
    btn.className='px-3 py-1 rounded bg-blue-500 text-white hover:bg-blue-700'
    btn.innerText = r + ' ('+regionCount[r]+')'
    btn.onclick=()=>{
      const list = allNodes.filter(n=>n.region===r).map(n=>n.raw).join('\n')
      document.getElementById('nodeOutput').value=list
    }
    box.appendChild(btn)
  })
}

function renderStats(){
  const typeCount={}
  const regionCount={}
  const names=[]

  allNodes.forEach(n=>{
    typeCount[n.type]=(typeCount[n.type]||0)+1
    regionCount[n.region]=(regionCount[n.region]||0)+1
    if(n.name) names.push(n.name)
  })

  document.getElementById('typeStats').innerHTML = '<b>类型统计</b>：<br>' +  Object.entries(typeCount).map(i=>i[0]+': '+i[1]).join(' | ')
  document.getElementById('regionStats').innerHTML = '<b>地区统计</b>：<br>' + Object.entries(regionCount).map(i=>i[0]+': '+i[1]).join(' | ')
  document.getElementById('nameList').innerText = names.join('\n')

  document.getElementById('jsonOutput').textContent = JSON.stringify(allNodes,null,2)

  renderRegionButtons(regionCount)
}


document.getElementById('parseBtn').onclick=function(){
  const lines = document.getElementById('input').value.split(/\r?\n+/).filter(Boolean)
  allNodes = []

  lines.forEach(l=>{
    try{allNodes.push(parseNode(l.trim()))}catch(e){}
  })

  renderStats()
}

document.getElementById('toggleJson').onclick=function(){
  document.getElementById('jsonOutput').classList.toggle('hidden')
}
</script>
</body>
</html>
